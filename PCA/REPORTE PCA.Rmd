---
title: "PCA"
author: "Lino Oswaldo Sánchez Juárez"
date: "24/3/2022"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Analisis de comoponentes principales 

## Introdución 

El análisis de componentes principales (**ACP**) es un método de reducción de la dimensionalidad de las variables originales es una técnica utilizada para describir un conjunto de datos en términos de nuevas variables («componentes») no correlacionadas,en donde los  componentes se ordenan por la cantidad de varianza original que tienen, así que esta técnica muy  útil para reducir la dimensionalidad de un conjunto de datos.

Principalmente lo que buscamos con el **ACP** es la proyección según la cual los datos queden mejor representados en términos de mínimos cuadrados, pues esta convierte un conjunto de observaciones de variables posiblemente correlacionadas en un conjunto de valores de variables sin correlación lineal llamadas componentes principales.

Las aplicaciones son en el análisis exploratorio de un conjunto de datos y con ello poder crear un modelo predictivo pues con el **ACP** conjunta el cálculo de la descomposición en auto valores de la matriz de covarianza, normalmente tras centrar los datos en la media de cada atributo.



## Matriz de trabajo 
1.- Se tarbajo conla matriz () extraiad del paquete **datos** que see necurntra  en el paquete precargado de r 
```{r,warning =FALSE, message =FALSE} 
install.packages("datos",repos = "http://cran.us.r-project.org")
```


```{r,warning =FALSE, message =FALSE}
library(datos)
```

2.- Se seleciono la matriz **atmosfera**
```{r}
BD<-(datos::atmosfera)
```

## Exploracion de matriz 
La matriz cuenta con 41472 observaciones y 11 variables
```{r}
dim(BD)
```

2.- Tipos de variables 
```{r}
str(BD)
```
3.- Nombres de las variables 
```{r}
colnames(BD)
```

4.- Enbusca de datos perdidos
```{r}
anyNA(BD)
```

## Trtamiento de la matriz 
El head se utiliza par copiar el nombre de la variable que no quieres 
```{r}
head(BD)
```
filtara las variables,quedarse con las cuantitativas
```{r}
BD[c("anio","mes","nube_baja","nube_alta","nube_media","longitud")]<-NULL 
```
Se eliminan las cualitativas y en el proceso se observa que otras variables que no son cualitativas en el scaterplot se puedo observar que no hay relación por eso se decide quitar desde este punto para trabajar mejor. 

Al tener muchas observaciones podemos filtrar y trabajar con menos 
```{r}
BD1 <- BD[1:1000,]
dim(BD1)
```

se vuelve a visualizar para asegurarse que se removieron las variables no deseadas y la dimensión de la matriz es menor
```{r}
str(BD1) 
```

# ACP pasos a paso 
1.- transformar la matriz en un data frame 
```{r}
BD_1<-data.frame(BD1)
```
2.- definir _n_ (individuos) y _p_ (variables) 
```{r}
n<-dim(BD_1)[1]
p<-dim(BD_1)[2]
```

3.- Generación de grafico **scaterplot**
```{r}
pairs(BD_1,col="indianred4", pch=1, 
      main="Variables originales")

```

4.- Obtención de la media por columna y la **matriz de covarianza muestral**
```{r}
mu<-colMeans(BD_1)
s<-cov(BD_1)
```

5.- Obtención de los **valores y vectores propios de la matriz de covarianza muestral** 
```{r}
es<-eigen(s)
es
```

5.1.- Separción de la matriz de valores propios 
```{r}
eigen.val<-es$values
eigen.val
```

5.2.- Separción de la matriz de vectores propios
```{r}
eigen.vec<-es$vectors
eigen.vec
```

6.-  Calcular la Proporcion de variabilidad 

6.1.- Para la matriz de valores propios 
```{r}
pro.var<-eigen.val/sum(eigen.val)
pro.var
```

6.2.- Acumulada 
```{r}
pro.var.acum<-cumsum(eigen.val)/sum(eigen.val)
pro.var.acum
```

7.- Obtención de la **matriz de correlaciones** 
```{r}
R<-cor(BD_1)
```

8.- Obtención de  los valores y vectores propios apartir de la **matriz de correlaciones **
```{r}
eR<-eigen(R)
eR
```

9.- Separacionnde la matriz de valores propiosapartir de la **matriz de correlaciones**


9.1.- Separccion de la matriz d evalores propios 
```{r}
eigen.val.R<-eR$values
eigen.val.R
```

9.2.-  separacion de la matriz de vectores propios 
```{r}
eigen.vec.R<-eR$vectors
eigen.vec.R
```

10.- calculo de la proporción  de variabilidad

10.1.- para la matriz de valores propios 
```{r}
pro.var.R<-eigen.val/sum(eigen.val)
pro.var.R
```

Grafíco de la proporción  de variabilidad

```{r}
plot(pro.var.R, type="l")
```
10.2.- Acumulada 

En este punto se seleccionan el numero de componentes, siguiendo el criterio del 80% de la varíanza explicada.

para este ejemplo se van a seleccionar **1** factores de **0.8145322** varianza explicada 
aunque con el grafíco vemos la inflexion (codo) en el segundo factor con el primero estamos cubiertos 
```{r}
pro.var.acum.R<-cumsum(eigen.val)/sum(eigen.val)
pro.var.acum.R
```

11.- Calcularc la media de los valores propios 
```{r}
mean(eigen.val.R)
```

## Obtención de coeficientes 

12.-Centrar los datos con respecto a la media 
12.1.- Construcción de matriz de unos
```{r}
ones<-matrix(rep(1,n),nrow=n, ncol=1)
```

12.2.- Construccion de la matriz centrada
```{r}
X.cen<-as.matrix(BD_1)-ones%*%mu
```

13.- Construcción de la matriz diagonal de las varianzas
```{r}
Dx<-diag(diag(s))
Dx
```


14.- Construccion de la matriz centrada multiplicada  por Dx^1/2
```{r}
Y<-X.cen%*%solve(Dx)^(1/2)
```

15.- Construccion de los coeficientes o scores **eigen.vec matriz de autovectores*
Semuestran las primeras 10 observaciones 
```{r}
scores<-Y%*%eigen.vec.R
scores[1.10,]
```

16.- Nombramos las columnas de acurdo a los componentes 
```{r}
colnames(scores)<-c("PC1","PC2","PC3","PC4","PC5" )
```

17.- Visualizar los scores
```{r}
scores[1:10,]
```

18.- Generacion del grafico de los scores
```{r}
pairs(scores, main="scores", col="chartreuse", pch=1)
```


# ACP via sintetizada 
1.- calculo de la varianza a las coolumnas 1= filas, 2= columnas 
```{r}
apply(BD_1, 2, var)

```


2.- aplicar la funcion **prcom** pra reducir la dimencinalidad y centrado por la nedia y escalada por la desviacion estandar (dividir entre sd)
```{r}
acp<-prcomp(BD_1, center=TRUE, scale=TRUE)
acp
```

3.- generacion del grafico **screeplot**
```{r}
plot(acp, type="l")

```

4.- Resumen de la matriz **acp**
```{r}
summary(acp)

```

4.1.- En este punto se seleccionan el numero de componentes, siguiendo el criterio del 80% de la varíanza explicada.

para este ejemplo se van a seleccionar **2** factores de **0.8683** varianza explicada

5.- Construcción del Biplot
```{r}
biplot(acp, scale=0)
```

# Construción de los componentes principales con las variables originales 

combinación lineal de las variables originales 

**Primer componente** 

Z1 = -0.360(latitud) + 0.514(temp_superficie) + 0.532(temperatura) + 0.307(presión) - 0.476(ozono)

**Segundo componente**

Z2 = -0.534(latitud) - 0.124(temp_superficie) - 0.125(temperatura) - 0.746(presión) - 0.353(ozono)



